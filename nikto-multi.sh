#!/bin/sh
set -eu

usage() {
  echo "Usage: ${0##*/} <target-hosts-list.txt>"
}

if [ "$#" -eq 0 ]; then
  echo "Error: Target hosts must be specified"
  usage
  exit 1
fi

if [ "$1" = "-h" ]; then
  usage
  exit 0
fi

today=`date +%Y%m%d`
if [ ! -d ./results/${today}/nikto ]; then
  mkdir -p ./results/${today}/nikto
fi

hosts=$(<$1)
echo "Target: ${hosts}"

for h in $hosts
do
  now=`date +%Y%m%d_%H%M%S`
  nikto -host ${h} -output results/${today}/nikto/${h}_nikto_${now}.xml -Format xml
done
